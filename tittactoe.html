<html>
<head>
    <style>
        .parent {
            display: flex;
            justify-content:center;
        }

        .left {
            //border: 1px solid;
        }
    </style>
    <script src='http://d3js.org/d3.v2.js'></script>
</head>

<body>
    
   

            <script type="text/javascript">


              (function ticTacToe() {
                
                var GameData = {
                     // Indexes representing cells in the Tic Tac Toe
                     cells : [0,1,2,3,4,5,6,7,8],
                     // List of cells frozen for any selection. Index of a cell gets added to frozenCells array once the user places his marker.
                     frozenCells : [],
                     // Marker 1
                     marker1: "X",
                     // Marker 2
                     marker2: "0",
                     // currentMarker 
                     currentMarker : "0",
                     //Variable indicating if the Game is complete
                     gameComplete : false,
                     // Indexes of the boxes which indicate completion of the game. If a player had 3 of same markers in the below indices he would win the game.
                     gameCompletionPaths : [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]],
                     // Adjustment factors for x and y
                     adjustmentFactor : [[0,65,130,65],[0,65,130,65],[0,65,130,65],[65,0,65,130],[65,0,65,130],[65,0,65,130],[0,0,130,130],[130,0,0,130]],
                     // Board settings for the Game
                     Board: {
                        width : "900px",
                        height : "900px",
                        // Container for the all of the Game graffics
                        svgContainer : ""
                     },
                     // Properties of the block that the user places his marker 
                     Block: {
                        width : "130px",
                        height: "130px",
                        fill: "#99A3A4",
                        stroke: "#D6EAF8",
                        strokeWidth: "5",
                        strokeOpacity: "0.8",
                        id: function(i) {return "rect" + i}
                     },
                     // Properties of the Text on each of the block 
                     Text: {
                        fontFamily:'"Lato", "Helvetica", Helvetica, sans-serif',
                        fontSize:"60px",
                        stroke:"#00ff00",
                        fill: "#0000ff",
                        id: function(i) {return "text" + i}
                     }
                };

                drawBoard();

                var getCurrentMarker = function() {
                    GameData.currentMarker = (GameData.currentMarker == GameData.marker2 || GameData.currentMarker == "") ? GameData.marker1 : GameData.marker2;
                    return GameData.currentMarker;
                }

                function drawBoard() {

                    var parentDiv = d3.select("body").append("div").attr("class","parent");
                    parentDiv.append("div").attr("class","left").attr("id","leftDiv");
                    var rightDiv = parentDiv.append("div").attr("class","right").attr("id","rightDiv");

                    // Create Parent SVG container
                    GameData.Board.svgContainer = rightDiv.append("svg");
                    
                    // Create g elements to group rectangles and the Text on top
                    var parentG = GameData.Board.svgContainer
                                    .attr("width", GameData.Board.width)
                                    .attr("height", GameData.Board.height)
                                    .selectAll("g")
                                    .data(GameData.cells)
                                    .enter()
                                    .append("g");

                    // Create te Square cells to represent each block of the Game
                    parentG.append("rect")
                            .attr("x", function(d) { return ((d%3) * 138);})
                            .attr("y", function(d) { return (Math.floor(d/3) * 138);})
                            .attr("width", GameData.Block.width)
                            .attr("height", GameData.Block.height)
                            .style("fill", GameData.Block.fill)
                            .style("stroke", GameData.Block.stroke)
                            .attr("id", function(d) { return GameData.Block.id(d)})
                            .style("stroke-width", GameData.Block.strokeWidth)
                            .style("stroke-opacity", GameData.Block.strokeOpacity)
                            .on('click', function(d,i){ handleClick(d,i);});

                    // Create Text elements to draw the text on each of the square        
                   parentG.append("text")
                            .style("font-family", GameData.Text.fontFamily)
                            .style("font-size", GameData.Text.fontSize)
                            .style("stroke", GameData.Text.stroke)
                            .style("fill", GameData.Text.fill)
                            .attr("x", function(d) {return (40 + 140 * (d%3));})
                            .attr("y", function(d) {
                                 var factor = (Math.floor(d/3) + 1);
                                return (factor * 80 + ((factor - 1) * 50));
                            })
                            .attr("id", function(d) {return GameData.Text.id(d)})
                            .on('click', function(d,i){handleClick(d,i);});                
                }
               
                function handleClick(d, i) {

                    // If user is clicking on a cell that has been already frozen do not process the click
                    if((GameData.frozenCells.indexOf('rect'+ d) > 0) || (GameData.frozenCells.indexOf('text'+ d) > 0) || GameData.gameComplete) {
                            // Do nothing value has been already set
                            return;
                    }
                    
                    // Get the currentMarker to place
                    var currentMarker = getCurrentMarker();
                    document.getElementById('text' + d).textContent = currentMarker;
                    // Check of the Game is complete
                    var index = isGameComplete(currentMarker);
                    // If the length of path is greater than one that means we have a path that completes the game.
                    if(index >= 0) {
                        GameData.gameComplete = true;
                        notifyGameOver(index);
                    }
                 
                    GameData.frozenCells.push('rect' + d);
                    GameData.frozenCells.push('text' + d);
                }

                function isGameComplete(player) {
                    
                    var matchCount = 0;

                    for(var i=0 ; i<=7 ; i++) {
                        var completePath = GameData.gameCompletionPaths[i];
                        for(var j=0;j<=2;j++) {
                             if(document.getElementById('text' + completePath[j]).textContent == player) {
                                matchCount++;
                             } else {
                                break;
                             }
                        }
                        if(matchCount == 3) {
                            return i;
                        } else {
                            matchCount = 0;
                        }
                    }

                    return -1;
              }


              function notifyGameOver(index) {
                    
                    var pathArray = GameData.gameCompletionPaths[index];
                    var textElement1 = document.getElementById('rect' + pathArray[0]);
                    var textElement2 = document.getElementById('rect' + pathArray[2]);

                    var x1 = textElement1.getAttribute("x");
                    var y1 = textElement1.getAttribute("y");

                    var x2 = textElement2.getAttribute("x");
                    var y2 = textElement2.getAttribute("y");
                        
                     
                    GameData.Board.svgContainer.append("g").append("line")
                                  .attr("x1", Number(x1) + GameData.adjustmentFactor[index][0])
                                  .attr("y1", Number(y1) + GameData.adjustmentFactor[index][1])
                                 .attr("x2", Number(x2) + GameData.adjustmentFactor[index][2])
                                 .attr("y2", Number(y2) + GameData.adjustmentFactor[index][3])
                                 .attr("id", "gameCompletionLine")
                                 .attr("stroke", "gray")
                                 .attr("stroke-width", "4")
                                 .attr("fill", "red");


                    var newGameG = GameData.Board.svgContainer.append("g");

                    newGameG.append("rect")
                            .attr("x", function(d) { return 0;})
                            .attr("y", function(d) { return 140;})
                            .attr("width", 400)
                            .attr("height", 130)
                            .attr("id", "newGameRect")
                            .style("fill", "blue")
                            .style("stroke", "white")
                            .on('click', function(){resetGame();});

                    newGameG.append("text")
                            .style("font-family", GameData.Text.fontFamily)
                            .style("font-size", "45px")
                            .style("stroke", GameData.Text.stroke)
                            .style("fill", GameData.Text.fill)
                            .attr("x", function(d) {return 140;})
                            .attr("y", function(d) {return 200;})
                            .text(function(d) {return "Start Again";})
                            .attr("id", "newGameText")
                            .on('click', function(){resetGame();});             


                                                    
             }
             
             function resetGame() {
                console.log("reset game");
                GameData.gameComplete = false;
                GameData.frozenCells = [];
                GameData.currentMarker = "0";
                for(var i=0;i<GameData.cells.length;i++) {
                    document.getElementById('text' + i).textContent = "";
                }

                var line = document.getElementById("gameCompletionLine");
                line.parentNode.removeChild(line);

                var rect = document.getElementById("newGameRect");
                rect.parentNode.removeChild(rect);

                var text = document.getElementById("newGameText");
                text.parentNode.removeChild(text);

             }         
                    
            })();

             

            </script>
       
   
    

</body>

</html>